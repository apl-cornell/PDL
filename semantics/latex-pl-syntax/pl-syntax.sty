\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{pl-syntax}
  [2019/04/22 version 1.0.0 Abstract Syntax Definitions for Programming Languages]

% Suppresses row breaks when set to true. Used to prevent unnecessary
% line breaks that would otherwise be generated by default.
\newif\if@syntax@suppressNewRow

% Whether we have encountered the first alternative in a category
% definition or not. Used to suppress a leading separator.
\newif\if@syntax@firstAlternative

% Define the abstract syntax of a programming language.
\newenvironment{syntax}
{%
  % Define a new syntactic category (e.g. expressions, statements).
  \newcommand{\category}[2][]{%
    \@newRow \textrm{##1} & ##2 & ::= &%
    \@syntax@firstAlternativetrue%
  }%
  % A category with no right-hand side. This allows you to name meta
  % variables without defining the syntactic category explicitly.
  \newcommand{\abstractCategory}[2][]{%
    \@newRow \textrm{##1} & ##2%
    \@syntax@firstAlternativetrue%
  }%
  % Define a new alternative for the most recent category.
  \newcommand{\alternative}[1]{%
    \@alt ##1%
    \@syntax@firstAlternativefalse%
  }%
  % Like `alternative`, but places the clause on a new line.
  \newcommand{\alternativeLine}[1]{%
    \@newRow & & \@alt & ##1%
    \@syntax@firstAlternativefalse%
  }%
  % Add extra information to the most recently declared alternative.
  % For example, you can use this to note that the context is unordered.
  \newcommand{\note}[1]{\@newRow & & & (\textrm{##1})}%
  % Add vertical space between declarations.
  \newcommand{\separate}[1][1ex]{\\[##1]\@syntax@suppressNewRowtrue}
  % Symbol used between alternatives.
  \newcommand{\@alt}{\if@syntax@firstAlternative \else \,\mid\, \fi}
  % Start a new row.
  \newcommand{\@newRow}{\if@syntax@suppressNewRow \@syntax@suppressNewRowfalse \else \\ \fi}
%
  \[\begin{array}{llcl}\@syntax@suppressNewRowtrue\ignorespaces%
}
{\end{array}\]\ignorespacesafterend}