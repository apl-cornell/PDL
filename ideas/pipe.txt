main {

  stage_1.init(0);

  stage_1(pc) {
    insn_calc(pc);
    stage_2(pc, _);
  }

  insn_calc(pc) {
    insn = mem.read(pc);
    stage_2(_, insn);
  }

  stage_2(pc, insn) {
    next_pc = br_unit.npc(pc, insn);
    stage_1(next_pc);
    stage_3(insn, rf.read_op_1(insn), rf.read_op_2(insn));
  }

  stage_3(insn, op1, op2) {
    if (is_write(insn)) {
      rf.write(insn.dest, alu(insn.op, op1, op2));
    }
  }
}
