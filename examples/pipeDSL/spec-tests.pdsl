/* Expected fail due to unexpected speculative call
pipe test1(input: int<32>)[rf: int<32>[5]] {
    speculate(int<32> nin = 0<32>, {
        nin = 1<32>;
    }, {
        call test1(nin);
    })
} */
//Expected Success
pipe test2(input: spec<int<32>>)[rf: int<32>[5]] {
    speculate(int<32> nin = 0<32>, {
        nin = 1<32>;
    }, {
        call test2(nin);
    })
    check(input);
}
/* Expected fail due to unresolved speculation by end
pipe test3(input: spec<int<32>>)[rf: int<32>[5]] {
    speculate(int<32> nin = 0<32>, {
        nin = 1<32>;
    }, {
        call test3(nin);
    })
} */
//Expected Success
pipe test4(input: int<32>)[rf: int<32>[5]] {
    acquire(rf);
    speculate(int<32> nin = 0<32>, {
        nin = 1<32>;
    }, {
        int<32> myval <- rf[nin{4:0}];
    })
    release(rf);
    ---
    call test4(myval);
}
//Expected Success
pipe test5(input: int<32>)[] {
    speculate(int<32> n = 0<32>, {
       speculate(int<32> y = 1<32>, {
            y = 7<32>;
       }, {
        n = y + 1<32>;
       })
    }, {
        speculate(int<32> t = 1<32>, {
            t = 0<32>;
        }, {
            int<32> z = t + n;
        })
    })
    call test5(z + t + n + y);
}
/* Expected Fail due to speculative mem write
pipe test6(input: spec<int<32>>)[rf: int<32>[5]] {
    acquire(rf);
    rf[input{31:27}] <- input;
    speculate(int<32> nin = 0<32>, {
        nin = 1<32>;
    }, {
        int<32> myval <- rf[nin{4:0}];
        ---
        call test6(myval);
    })
    release(rf);
} */
circuit {
    r = memory(int<32>, 5);
    t = new test2(0<32>)[r];
}